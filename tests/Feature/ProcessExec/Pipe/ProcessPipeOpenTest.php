<?php

namespace Tests\Feature\ProcessExec\Pipe;

use Tests\TestCase;
use Takuya\ProcessExec\ExecArgStruct;
use Takuya\ProcessExec\ProcessExecutor;

class ProcessPipeOpenTest extends TestCase {
  
  public function test_start_pipe_process_by_struct () {
    $arg1 = new ExecArgStruct();
    $arg1->setCmd( ['bash'] );
    $src = <<<EOS
      echo -n '<?php echo "Hello World".PHP_EOL;';
      EOS;
    $arg1->setInput( $src );
    $arg2 = new ExecArgStruct();
    $arg2->setCmd( ['php'] );
    $e1 = new ProcessExecutor( $arg1 );
    $e2 = $e1->pipe( $arg2 );
    $e2->start();
    $out = $e2->getOutput();
    $this->assertEquals( "Hello World".PHP_EOL, $out );
  }
  
  public function test_start_pipe_process_by_executor () {
    $arg1 = new ExecArgStruct();
    $arg1->setCmd( ['bash'] );
    $src = <<<EOS
      echo -n '<?php echo "Hello World".PHP_EOL;';
      EOS;
    $arg1->setInput( $src );
    $arg2 = new ExecArgStruct();
    $arg2->setCmd( ['php'] );
    $e1 = new ProcessExecutor( $arg1 );
    $e2 = new ProcessExecutor( $arg2 );
    $e1->pipe( $e2 );
    $e2->start();
    $out = $e2->getOutput();
    $this->assertEquals( "Hello World".PHP_EOL, $out );
  }
}